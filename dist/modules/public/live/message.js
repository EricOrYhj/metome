define(function(require,exports,module){var t=require("../common/tool");require("../common/config"),require("../common/constant");var e={};e.options={uid:"",same:!1,me:!1},e.format=function(a,n){for(var o=[],i=0;i<a.length;i++){var r=a[i];e.options.same=e.options.uid===r.uid,e.options.uid=r.uid,e.options.me=r.internalStatus>=2;var s=(r.atUid,{id:r.id,ctime:r.createTime,time:t.formatMsgTime(r.createTime),uid:r.uid,avatar:r.avatar+Config.AVATAR_100,placeholder:Config.avatarImgPath,uname:r.nickName,me:e.options.me,same:e.options.same,mid:r.fragmentId,ustatus:r.internalStatus,cidat:!1,uidat:!1});if(0!==r.contentType||0!==r.type&&1!==r.type)if(0===r.contentType&&4===r.type)s.type=Constant.MSGTYPE_TEXT,s.class="text",r.fragment=r.fragment,s.content=e.Emotion(r.fragment),s.content=e.Mark(r.fragment);else if(0===r.contentType&&3===r.type)s.type=Constant.MSGTYPE_FEEL,s.class="feel",r.fragment=r.fragment,s.content=e.Emotion(r.fragment);else if(1!==r.contentType||0!==r.type&&1!==r.type){if(13===r.type||13===r.contentType){s.type=Constant.MSGTYPE_AUDIO,s.class="audio msgCard";var m=JSON.parse(r.fragment),c=parseInt(m.duration/1e3),p=30;120/parseInt(m.duration/1e3)<3&&(p=100/parseInt(120/parseInt(m.duration/1e3))),s.file={original:r.fragmentImage,duration:c,width:p}}else if(12===r.type||12===r.contentType)s.type=Constant.MSGTYPE_VIDEO,s.class="video msgCard",s.file={original:r.fragment,placeholder:r.fragmentImage};else if(11===r.type||11===r.contentType){s.cidat=!0,s.type=Constant.MSGTYPE_TEXT,s.class="text";var l=JSON.parse(r.fragment),g=e.At(l.text,l.atStart,l.atEnd);s.content=e.Emotion(g)}else if(10===r.type||10===r.contentType){s.type=Constant.MSGTYPE_TEXT,s.class="text";var l=JSON.parse(r.fragment),g=e.At(l.text,l.atStart,l.atEnd);s.content=e.Emotion(g)}}else s.type=Constant.MSGTYPE_PIC,s.class="pic msgCard",s.file={original:r.fragmentImage+Config.PREVIEW_IMG,placeholder:Config.placeholderImgPath};else s.type=Constant.MSGTYPE_TEXT,s.class="text",r.fragment=r.fragment,s.content=e.Emotion(r.fragment),s.content=e.Tag(r.fragment);o.push(s)}return console.log(o),o},e.cover=function(a){a.title=e.Tag(a.title);var n={ctime:a.createTime,time:t.formatMsgTime(a.createTime),uid:a.uid,avatar:a.avatar+Config.AVATAR_100,placeholder:Config.avatarImgPath,uname:a.nickName,type:Constant.MSGTYPE_PIC,class:"pic msgCard",file:{original:a.coverImage+Config.PREVIEW_IMG,placeholder:Config.placeholderImgPath},title:a.title,zindex:10001};return n},e.Mark=function(t){return t='<span class="audioColor"> 「'+t+"」</span>"},e.Tag=function(t){var e=(/^「(.*)」$/g.exec(t),new RegExp("\\「(.+)\\」","gi")),a=e.exec(t);return a&&a.length>0&&(t=t.replace(a[0],'<span class="audioColor">'+a[0]+"</span>")),t},e.At=function(t,e,a){var n=t.substr(e,a);return t=t.replace(n,'<span class="audioColor">'+n+"&nbsp;&nbsp;</span>")},e.Emotion=function(t){return $.fn.emotion.parse(t)},module.exports=e});