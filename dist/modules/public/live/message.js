define(function(require,exports,module){var e=require("../common/tool");require("../common/config"),require("../common/constant");var a={};a.options={uid:"",same:!1,me:!1},a.format=function(t,n){for(var i=[],o=0;o<t.length;o++){var r=t[o];a.options.same=a.options.uid===r.uid,a.options.uid=r.uid,a.options.me=r.uid===n;var m=(r.atUid,{id:r.id,ctime:r.createTime,time:e.formatMsgTime(r.createTime),uid:r.uid,avatar:r.avatar+Config.AVATAR_100,placeholder:Config.avatarImgPath,uname:r.nickName,me:a.options.me,same:a.options.same,mid:r.fragmentId,ustatus:r.internalStatus});if(0===r.contentType)m.type=Constant.MSGTYPE_TEXT,r.fragment=r.fragment,m.content=a.parse(r.fragment),a.Tag(r.fragment),m.class="text";else if(1===r.contentType)m.type=Constant.MSGTYPE_PIC,m.class="pic msgCard",m.file={original:r.fragmentImage,placeholder:Config.placeholderImgPath};else if(13===r.type||13===r.contentType){m.type=Constant.MSGTYPE_AUDIO,m.class="audio msgCard";var s=JSON.parse(r.fragment),c=parseInt(s.duration/1e3),g=30;120/parseInt(s.duration/1e3)<3&&(g=100/parseInt(120/parseInt(s.duration/1e3))),m.file={original:r.fragmentImage,duration:c,width:g}}else 12!==r.type&&12!==r.contentType||(m.type=Constant.MSGTYPE_VIDEO,m.class="video msgCard",m.file={original:r.fragment,placeholder:r.fragmentImage});i.push(m)}return console.log(i),i},a.cover=function(t){t.title=a.Tag(t.title);var n={ctime:t.createTime,time:e.formatMsgTime(t.createTime),uid:t.uid,avatar:t.avatar+Config.AVATAR_100,placeholder:Config.avatarImgPath,uname:t.nickName,type:Constant.MSGTYPE_PIC,class:"pic msgCard",file:{original:t.coverImage,placeholder:Config.placeholderImgPath},title:t.title,zindex:10001};return n},a.Tag=function(e){var a=(/^「(.*)」$/g.exec(e),new RegExp("\\「(.+)\\」","gi")),t=a.exec(e);return t&&t.length>0&&(e=e.replace(t[0],'<span class="audioColor">'+t[0]+"</span>")),e},a.parse=function(e){return $.fn.emotion.parse(e)},module.exports=a});