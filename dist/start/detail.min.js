define(function(t,e,i){t("tooltip"),t("../../vendor/jquery/jquery-ui-1.10.4.custom.js"),t("../../vendor/jquery/jquery.slider.js");var o=t("doT"),n=t("../list/list.js"),a=t("../common/common.js"),p=t("../common/constant"),s={};s.init=function(){s.bindEvent()},s.bindEvent=function(){$(document).on("click",".appGridHover",function(){s.getAppDetail($(this))}),$(document).on("click",".appGridHover",function(){s.getAppDetail($(this))}),s.commentLike(),s.commentUnlike(),s.appCatClick();var t=$(".changeTabName");t.click(function(){var e=$(this),i=e.attr("data-id");t.removeClass("changeTabNameCurrent"),t.each(function(){$(this).attr("data-id")==i&&$(this).addClass("changeTabNameCurrent")}),$(".catItem").removeClass("catItemCurrent").find("i").addClass("icon-1xColor"),"myApp"==i?($("#catChoose").hide(),$("#myAppChoose").show(),$("#myAppChoose li:eq(0)").addClass("catItemCurrent").find("i").removeClass("icon-1xColor"),n.getAppList(s,"myApp","All")):($("#catChoose").show(),$("#myAppChoose").hide(),$("#catChoose li:eq(0)").addClass("catItemCurrent").find("i").removeClass("icon-1xColor"),n.getAppList(s,"","home"))}),$(".typeListFrame .typeListFrameItem").click(function(){var t=$(this).attr("data-id");t&&(p.appType2=t,"myApp"==p.appType&&(p.category.categoryId=t)),$(".typeValue").text($(this).text()),n.getAppList(s,p.appType,p.category.categoryId)}),$(".MRightPage .appRemmondGrid").click(function(){var t=$(this).attr("data-id");t&&(p.appType2=t),"myApp"==t?n.getAppList(s,"myApp",p.category.categoryId):n.getAppList(s,p.appType,p.category.categoryId)}),$(".recGridLink").click(function(){var t=$(this),e=t.attr("data-id"),i=$(".changeTabNameCurrent").attr("data-id");""!=e&&null!=e&&("home"==e?location.replace(location.href):n.getAppList(s,i,e))});var e=$(".loadingbox");if(0===e.length){var i="";i+='<div class="loadingbox">',i+='<div class="overlay"></div>',i+='<div class="loadingCircle"><div class="loadingCircleImg"></div></div>',i+="</div>",$("body").append(i)}var o=$("#hiddenAppid").val();o&&s.getAppDetail("",o),$(document).on({mouseover:function(){var t=$(this);if(!t.data("bindtip")){var e=parseInt(t.css("paddingTop")),i=30,o=10;!e>0&&(e=0,i=0,o=5),t.MD_UI_Tooltip({arrowLeft:o,offsetLeft:i,offsetTop:e,width:180,checkWidth:!0,checkHeight:!0}),t.data("bindtip",!0),t.mouseenter()}},mouseout:function(){$(".md_tooltip").hide(),$(".md_tooltip").remove()}},".iconTip")},s.Options={relCommLoading:0,score:0,appID:"",topicsAllCount:10,detail:"",recommendAppList:"",myTopic:"",appName:"",appIcon:"",appList:"",admins:"",listLength:0,length:0,rowLength:6,allCount:0,recommendApptop:0,groupHtml:"",selectGroupHeight:"",type:"",viewType:1},s.appCatClick=function(){$(".catItem").unbind("click").click(function(){var t=$(this),e=t.find(".catLink").attr("data-id"),i=$(".changeTabNameCurrent").attr("data-id");$(".catItem").addClass("catItemChoose").find("i").addClass("icon-1xColor"),$(".catItemChoose").removeClass("catItemCurrent"),t.removeClass("appCategoryHover").addClass("catItemCurrent").find("i").removeClass("icon-1xColor"),$(".mTopFixed").is(":hidden")||(p.page.pageSize=10),""!=e&&null!=e?"home"==e?location.replace(location.href):("Company"!=e&&"Person"!=e&&"SoldOut"!=e||(i="myApp",p.project.projectId=""),"Company"==e&&(p.project.projectId=t.find(".catLink").attr("project-id")),n.getAppList(s,i,e)):$(".appCategoryMergeUl").is(":hidden")?$(".appCategoryMergeUl").show():$(".appCategoryMergeUl").hide(),"caidJiantou"==$(".mNavLog").attr("data-id")?($(".mNavLog").find("img").attr("src","../Content/images/caidList.gif"),$(".mNavLog").attr("data-id","caidList")):($(".mNavLog").find("img").attr("src","../Content/images/caidJiantou.gif"),$(".mNavLog").attr("data-id","caidJiantou"))})},s.getAppDetail=function(e,i){i?s.Options.appID=i:s.Options.appID=e.attr("appID"),$(".loadingbox").show();var n="all";/android/i.test(navigator.userAgent)&&(n="android"),/ipad|iphone|mac/i.test(navigator.userAgent)&&(n="iphone"),history.replaceState({},"明道应用市场","?appID="+s.Options.appID),t.async("./tpl/detail.html",function(t){$.get("/App/Index?format=json",{AppID:s.Options.appID},function(e){if(s.Options.detail=e.AppDetails,s.Options.detail){s.Options.recommendAppList=e.RecommendAppList,s.Options.topics=e.Topics,s.Options.topicsAllCount=e.topicsAllCount,s.Options.myTopic=e.MyTopic,p.user=e.User,p.project.projects=e.ProjectList,s.Options.appIcon=s.Options.detail.AvatarFull,s.Options.appName=s.Options.detail.AppName,s.Options.myTopic&&(s.Options.score=s.Options.myTopic.Score);var i=o.template(t)({appdetail:s.Options.detail,recommendAppList:s.Options.recommendAppList,topics:s.Options.topics,topicsAllCount:s.Options.topicsAllCount,myTopic:s.Options.myTopic,user:p.user,phoneType:n,projects:p.project.projects});$(".loadingbox").hide();var c=$(".remindbox"),r=c.find(".container");c.hide(),r.find(".content").html(""),a.showAppDetailFrom(i,function(t){}),s.slides(),s.myComment(),s.myCommentCommit(),$(".detailsPage .appButton").click(function(){if("all"!=n&&"false"==s.Options.detail.IsWeb)a.Commit("该应用未提供移动适配方案，请到PC网页进行安装和使用",2);else{var t=$(this);s.appInstall(t)}}),s.moreComment(),s.manageButton(),$(".lightbox").scroll(function(){$(".container"),$(this)[0].scrollTop,$(".container").offset().top})}else{$(".loadingbox").hide();var c=$(".remindbox"),r=c.find(".container");c.hide(),r.find(".content").html(""),a.Commit("找不到该应用！",2)}})})},s.slides=function(){$("#slides").slidesjs({width:630,height:400,play:{active:!0,auto:!0,interval:3e3,swap:!0},callback:{loaded:function(t){var e=$(".slidesjs-control img").eq(t-1),i=new Image;return i.src=e.attr("src"),i.complete?void s.imgOnload(e,i):void e.load(function(){s.imgOnload(e,i)})},start:function(t){var e=$(".slidesjs-control img").eq(t-1),i=new Image;return i.src=e.attr("src"),i.complete?void s.imgOnload(e,i):void e.load(function(){s.imgOnload(e,i)})}}})},s.imgOnload=function(t,e){var i=e.width,o=e.height,n=0,a=0,p=$(".appDetail .appImages").width(),s=400;p<630&&(s=200),i>=p&&i/p>=o/s?(o=o/i*p,i=p,o<s&&(n=(s-o)/2)):o>s?(i=i/o*s,o=s,i<p&&(a=(p-i)/2)):(n=(s-o)/2,a=(p-i)/2),t.css({width:i,height:o,"margin-top":n+"px","margin-left":a+"px"})},s.myComment=function(){var t=$(".myCommentNotice"),e=$(".myCommentMsg");0===t.length&&0===e.length?s.myCommentMouseOver():e.length>0&&s.myCommentUpdate(e)},s.myCommentUpdate=function(t){$(".myCommentUpdate").click(function(){s.myCommentMouseOver(),$(this).hide(),$(".myCommentMsg").hide(),$(".myComment").show(),$("#myCommentTextarea").val(t.text())})},s.myCommentMouseOver=function(){$(".appTopicsStar .topicStarSize").mouseover(function(){var t=$(this).attr("score"),e=new Number(t)+1;if(null!=t)for(var i=0;i<e;i++)$("#score"+i).removeClass("topicStarWhite"),$("#score"+i).addClass("topicStarBlue")}).mouseout(function(){$(".appTopicsStar .topicStarSize").removeClass("topicStarBlue"),$(".appTopicsStar .topicStarSize").addClass("topicStarWhite")}),$(".appTopicsStar .topicStarSize").click(function(){$(".appTopicsStar .topicStarSize").unbind("mouseout"),$(".appTopicsStar .topicStarSize").unbind("mouseover"),$(".appTopicsStar .topicStarSize").removeClass("topicStarBlue"),$(".appTopicsStar .topicStarSize").addClass("topicStarWhite");var t=$(this).attr("score"),e=new Number(t)+1;if(s.Options.score=2*e,null!=t)for(var i=0;i<e;i++)$("#score"+i).removeClass("topicStarWhite"),$("#score"+i).addClass("topicStarBlue");$(".myComment").show()})},s.myCommentCommit=function(){$(".myCommentCommit").click(function(){var t=$("#myCommentTextarea").val().trim();return t?s.Options.score?void $.post("/Topic/Add?format=json",{AppID:s.Options.appID,Content:t,Score:s.Options.score},function(e){if(e.result){a.Commit("评论成功"),$(".myComment").hide();var i=$(".myCommentMsg");0===i.length&&$(".appTopicsStar").append('<div class="myCommentMsg"></div>'),$(".myCommentMsg").show(),$(".myCommentMsg").text(t),$(".myCommentMsg").append('<div class="myCommentUpdate"><div class="myCommentUpdateImg"></div><span style="padding-left:10px;">修改</span></div>'),s.myCommentUpdate($(".myCommentMsg")),$(".topicStarSize").unbind()}else a.Commit("评论失败，请重试",2)}):a.Commit("请评分",2):a.Commit("请输入评价内容",2)})},s.appInstall=function(t){var e=t.attr("action");if("install"===e)s.appInstallPersonal(t);else if("recommend"===e)p.project.projectId=t.attr("projectid"),s.recommandAdmin(t);else if("login"===e)location.href="https://www.mingdao.com/login.htm?ReturnUrl=https://app.mingdao.com";else if("company"==e)p.project.projectId=t.attr("projectid"),s.Config(t);else if("delete"==e)s.UnInstall(t);else if("topic"==e)s.AddTopic(t);else if("open"==e){var i=t.attr("homeUrl");window.open(i)}else"detail"==e&&s.getAppDetail("",t.closest(".listPageAppDetail").find(".appGridHover").attr("appid"))},s.appInstallPersonal=function(e){var i=$(".installLoading div"),n={avatar:s.Options.appIcon,name:s.Options.appName,appID:s.Options.appID,homeUrl:"",message:""};i.show().animate({width:"70%"},1e3,function(){}),t.async("./tpl/install.html",function(t){$.post("/App/Install?format=json",{appid:s.Options.appID},function(p){p.result?i.animate({width:"100%"},300,function(){setTimeout(function(){i.fadeOut(500).css("width","0")},3e3),n.message="应用安装成功",n.homeUrl=p.app.HomeUrl;var a=o.template(t)(n),c=$(".installBox");0===c.length&&$("body").append('<div class="installBox"></div>'),$(".installBox").append(a),$(".installBox").show(),$(".installForm").animate({right:"15px"},500,function(){$(".installForm .appCancle").click(function(){$(".installForm").animate({right:"-300px"},500,function(){$(".installBox").html(""),$(".installBox").hide()})})}),e.attr("action",""),e.text("已安装"),s.myCommentMouseOver(),$(".myCommentNotice").hide()}):i.animate({width:"90%"},200,function(){setTimeout(function(){i.fadeOut(500).css("width","0")},3e3),p.error?n.message=p.error:n.message="应用安装失败",a.Commit(p.error,"2");var e=o.template(t)(n),s=$(".installBox");0===s.length&&$("body").append('<div class="installBox"></div>'),$(".installBox").append(e),$(".installBox").show(),$(".installForm").animate({right:"15px"},500,function(){$(".installForm .appCancle").click(function(){$(".installBox").html(""),$(".installBox").hide()})})})})})},s.recommandAdmin=function(e){t.async("./tpl/recommend.html",function(t){$.get("/Project/Admin?projectid="+p.project.projectId,{},function(i){s.Options.admins=i;var n=e.parent();s.Options.appIcon||(s.Options.appIcon=n.find(".appGridHover").find(".appGridImg").attr("src"));var p={admins:s.Options.admins,avatar:s.Options.appIcon,name:s.Options.appName,appID:s.Options.appID,message:"推荐成功"},c=o.template(t)(p),r=$(".recommendbox");0===r.length&&$("body").append('<div class="recommendbox"><div class="overlay"></div><div class="recommendDetail"></div></div>'),$(".recommendDetail").append(c);var m=$(".recommendDetail .recommendDialog"),l=($(window).width()-m.width())/2;l=l<0?0:l,m.css("left",l+"px").css("top","100px"),$(".recommendbox").show(),$(".recommendbox .cancelButton").click(function(){$(".recommendbox").hide(),$(".recommendbox .recommendDetail").html("")}),$(".recommendbox .submitButton").click(function(){for(var t=[],e=$(".recommendbox").find(".managerItem"),i=0;i<e.length;i++){var o=$(e[i]);o.find(".managerCheckbox").prop("checked")&&t.push(o.data("id"))}var n=$(".recommendbox").find("#recommendReason").val(),p="我觉得应用 "+s.Options.appName+" 很赞，";n&&"填写推荐理由！"!=n?(p+=n,0==t.length?($(".recommendbox .submitTitle").show(),$(".recommendbox .warnMsg").text("需要选择管理员")):$.post("/App/Suggest?format=json",{Admins:t.join(","),Message:p},function(t){t?a.Commit("推荐成功！"):a.Commit("推荐失败！",3)})):($(".recommendbox .submitTitle").show(),$(".recommendbox .warnMsg").text("需要填写推荐理由"))}),$(".recommendbox .overlay").click(function(t){var e=$(t.target);0==e.closest(".recommendbox .recommendDetail").length&&($(".recommendbox").hide(),$(".recommendbox .recommendDetail").html(""))}),$("#recommendReason").focus(function(){if($(this)){var t=$(this).html();"填写推荐理由！"==t&&$(this).html("")}}).blur(function(){var t=$(this).html();""==t&&$(this).html("填写推荐理由！")})})})},s.moreComment=function(){$(".appCommentsMore").click(function(){$(".appCommentsMore").unbind(),t.async("./tpl/topic.html",function(t){$.get("/Topic/Index/"+s.Options.appID,{pagesize:s.Options.topicsAllCount,format:"json"},function(e){s.Options.topics=e.topicList,p.user=e.user;var i=o.template(t)({topics:s.Options.topics,user:p.user});$(".appComments").html(""),$(".appComments").html(i)})})})},s.commentLike=function(){$(document).on("click",".commentLikeWhite",function(){var t=$(this),e=t.attr("topicID");$.get("/Topic/Like",{topicID:e,format:"json"},function(e){if(e){a.Commit("已赞"),t.removeClass("commentLikeWhite").addClass("commentLikeBlue").attr("action","unlike");var i=parseInt(t.parent().find(".commentLikeNum").text());i?(i++,t.parent().find(".commentLikeNum").text(i)):(i=1,t.parent().find(".commentLikeNum").text(i))}else a.Commit("失败",2)})})},s.commentUnlike=function(){$(document).on("click",".commentLikeBlue",function(){var t=$(this),e=t.attr("topicID"),i=t.attr("action");"unlike"===i?$.get("/Topic/unLike",{topicID:e,format:"json"},function(e){if(e){a.Commit("取消成功"),t.removeClass("commentLikeBlue").addClass("commentLikeWhite").attr("action","like");var i=parseInt(t.parent().find(".commentLikeNum").text());i?(i--,t.parent().find(".commentLikeNum").text(i)):(i="",t.parent().find(".commentLikeNum").text(i))}else a.Commit("失败",2)}):"like"===i&&$.get("/Topic/Like",{topicID:e,format:"json"},function(e){if(e){a.Commit("取消成功"),t.removeClass("commentLikeWhite").addClass("commentLikeBlue").attr("action","unlike");var i=parseInt(t.parent().find(".commentLikeNum").text());i?(i--,t.parent().find(".commentLikeNum").text(i)):(i="",t.parent().find(".commentLikeNum").text(i))}else a.Commit("取消失败",2)})})},s.appListTree=function(){$("#changeViewShu").click(function(){s.Options.viewType=2,n.getAppList(s,p.appType,p.category.categoryId,1)})},s.appListSingle=function(){$("#changeViewHeng").click(function(){s.Options.viewType=1,n.getAppList(s,p.appType,p.category.categoryId,1)})};var c;s.manageButton=function(){$(".appManageButton").hover(function(t){t.preventDefault(),clearTimeout(c);var e=$(this).parent().find(".appManageActionList");e.css("display","inline-block").hover(function(t){clearTimeout(c)},function(t){$(this).hide()})},function(t){t.preventDefault();var e=$(this).parent().find(".appManageActionList");c=setTimeout(function(t){e.hide()},300)})},s.appListSingleRecommand=function(){$(".listPageAppDetail .appAction").click(function(){var t=$(this),e=t.parent().parent().parent();s.Options.appID=e.parent().find(".appGridHover").attr("appid");var i=e.parent();s.Options.appName=i.find(".propertyFrame").find(".appName").text(),s.Options.appIcon=i.find(".appGridIcon").find(".appGridImg").attr("src"),s.appInstall(t)})},s.QueueFadeIn=function(){var t=$("#appListPage .listPageAppDetail,#appListPage .appGridNext,#appListPage .appGridTabLast").eq(s.Options.relCommLoading);t.fadeIn(100,function(){s.Options.relCommLoading++,s.QueueFadeIn()})},s.AddTopic=function(e){var e=e.parent().parent().parent(),i=e.parent().find(".propertyFrame").find(".appCategory").find("span").text();t.async("./tpl/addtopic.html",function(t){$.get("/Topic/My?appid="+s.Options.appID,function(e){var n="";e.result?(n=e.topic.Message,s.Options.score=e.topic.Score):(n="",s.Options.score=0);var p=o.template(t)({appIcon:s.Options.appIcon,appName:s.Options.appName,categories:i,topicMessage:n,score:s.Options.score});a.showRemindbox(p),s.myCommentMouseOver(),$(".myCommentCommit").click(function(){var t=$(".myCommentTextarea").val().trim();t||($(".addTopicBox .submitTitle").show(),$(".addTopicBox .warnMsg").text("需要填写评论理由")),s.Options.score||($(".recommendbox .submitTitle").show(),$(".addTopicBox .warnMsg").text("需要选择评论分数")),$.post("/Topic/Add?format=json",{AppID:s.Options.appID,Content:t,Score:s.Options.score},function(t){t.result?a.Commit("评论成功"):a.Commit("评论失败，请重试",2)})})})})},s.UnInstall=function(e){var i=e.attr("projectid");i||(i=p.project.projectId);var e=e.parent().parent().parent(),n=e.parent().find(".propertyFrame").find(".appCategory").find("span").text();t.async(["./tpl/cancelinstall.html","./tpl/uninstall.html"],function(t,e){var p=o.template(t)({appIcon:s.Options.appIcon,appName:s.Options.appName,categories:n});a.showRemindbox(p),$(".cancelInstallBox .submitButton").click(function(){$.post("/App/UnInstall?format=json",{appID:s.Options.appID,projectid:i},function(t){t.result?($(".installLoading div").css("width","100%"),$(".installLoading div").show(),$(".installLoading div").animate({width:"0"},1e3,function(){setTimeout(function(){$(".installLoading div").fadeOut(500),$(".installLoading div").css("width","0")},3e3);var t={avatar:s.Options.appIcon,name:s.Options.appName,appID:s.Options.appID,message:"卸载成功"},i=o.template(e)(t),n=$(".installBox");0===n.length&&$("body").append('<div class="installBox"></div>'),$(".installBox").append(i),$(".installBox").show(),$("#div_"+s.Options.appID).prev().remove(),$("#div_"+s.Options.appID).remove(),$(".installForm").animate({right:"15px"},500,function(){$(".installForm .appRecommendCancle").click(function(){$(".installForm").animate({right:"-300px"},500,function(){$(".installBox").html(""),$(".installBox").hide()})})})}),$(".remindbox").hide(),$(".remindbox .cancelInstallDetail").html("")):a.Commit("卸载失败","2")})}),$(".cancelInstallBox .cancelButton").click(function(){$(".remindbox").hide(),$(".remindbox .cancelInstallDetail").html("")})})},s.Config=function(e){t.async(["./tpl/config.html","./tpl/install.html"],function(t,e){$.get("/App/Config",{appid:s.Options.appID,projectid:p.project.projectId,format:"json"},function(i){if(i.result){var n=i.error;a.Commit(n,"2")}else{var c=i.Admins,r=i.Groups,m=o.template(t)({appIcon:s.Options.appIcon,appName:s.Options.appName,admins:c,groups:r,user:p.user});a.showConfigbox(m),r&&r.length>0&&($(".selectGroupRadio").attr("checked",!1),$(".selectGroupRadioGroups").prop("checked",!0),$("#partGroupsRadio").show()),$(".appConfigDetail .addAdminButton").click(function(){var t=$(".configbox .container").css("top");s.getAdminBox(t)}),$(".appConfigDetail #partGroupsRadio").click(function(){s.selectGroup()}),$(".appConfigDetail .submitButton").click(function(){var t=[];if(!$("#allGroupsRadio").is(":checked"))for(var i=$(".selectedGroupList .selectedGroupItem"),n=0;n<i.length;n++)t.push($(i[n]).data("id"));for(var c=[],r=$(".addedAdminList .addedAdminItem"),n=0;n<r.length;n++)c.push($(r[n]).data("id"));$.post("/App/Config?format=json",{appid:s.Options.appID,projectid:p.project.projectId,CustomName:s.Options.appName,GroupIDs:t.join(","),AdminIDs:c.join(",")},function(t){if(t.result)if("config"==t.configtype)a.Commit("设置成功！");else{var i={avatar:s.Options.appIcon,name:s.Options.appName,appID:s.Options.appID,message:""};$(".installLoading div").show(),$(".installLoading div").animate({width:"100%"},600,function(){setTimeout(function(){$(".installLoading div").fadeOut(500),$(".installLoading div").css("width","0")},3e3),i.message="应用安装成功",i.homeUrl=t.app.HomeUrl;var n=o.template(e)(i),a=$(".installBox");0===a.length&&$("body").append('<div class="installBox"></div>'),$(".installBox").append(n),$(".installBox").show(),$(".installForm").animate({right:"15px"},1e3,function(){$(".installForm .appCancle").click(function(){$(".installForm").animate({right:"-300px"},500,function(){$(".installBox").html(""),$(".installBox").hide()})})});var p=$(".detailsPage");p.find(".appApplyButton").attr("action","company"),p.find(".appApplyButton").text("管理"),$("#div_"+s.Options.appID).find(".appApplyButton").text("管理"),s.myCommentMouseOver(),$(".myCommentNotice").hide()})}else t.error?a.Commit(t.error):a.Commit("安装失败，请重试")})}),$(".appConfigDetail .cancelButton").click(function(){var t=$(".configbox");t.hide(),container.find(".content").html("")}),s.checkGroupButtom(),s.initDeleteLink()}})})},s.getAdminBox=function(t){var e='<div class="configAdminForm"><div class="configAdminDetail">';e+='<label class="addAdminLink" for="addAdminCheckbox">+添加管理员</label>',e+='<input type="checkbox" class="addAdminCheckbox" id="addAdminCheckbox">',e+='<input type="text" class="addAdminInput" placeholder="输入同事姓名或Email..."></div><div style="height:10px;"></div></div>',a.showConfigAdminbox(e,t),s.selectUsers()},s.selectUsers=function(){var t=$(".addAdminInput");$.widget("custom.adminAutoComplete",$.ui.autocomplete,{_renderItem:function(t,e){var i=e.label.split("\t\t\t")[0],o=(e.label.split("\t\t\t")[1],e.label.split("\t\t\t")[2]),n=$("<li>").addClass("adminAutocompleteItem").attr("id","li_"+e.value);n.data("item.autocomplete",e);var a=$("<a>").addClass("adminAutocompleteLink"),p=$("<div>").addClass("userAvatar");p.append("<img src="+o+' class="userIcon">');var s=$("<div>").addClass("nameDiv");return s.text(i),a.append(p).append(s),a.appendTo(n),n.appendTo(t),$(".configAdminDetail").append(t),n}}),t.adminAutoComplete({source:function(t,e){var i=t.term;$.get("/Project/User?format=json&keywords="+i+"&projectid="+p.project.projectId,function(t){for(var i=[],o=0;o<t.length;o++){var n=t[o];i.push({label:n.name+"\t\t\t"+n.email+"\t\t\t"+n.avatar,value:n.id})}e(i)})},select:function(t,e){if(t.preventDefault(),e.item){for(var i=$(".addedAdminItem"),o=0;o<i.length;o++)if($(i[o]).data("id")==e.item.value)return void a.Commit("已选择","2");$(".addedAdminList").append($('<li class="addedAdminItem" data-id="'+e.item.value+'"><span><img src="'+e.item.label.split("\t\t\t")[2]+'" alt="" class="groupAvatar"></span><span class="addedAdminName">'+e.item.label.split("\t\t\t")[0]+'</span> <span class="addedAdminDeleteLink">×</span></li>')),s.initDeleteLink()}},focus:function(e,i){e.preventDefault(),i.item&&($(".adminAutocompleteItem").css("background",""),$("#li_"+i.item.value).css("background","#c6d9e4"),t.val(i.item.label.split("\t\t\t")[0]))}})},s.selectGroup=function(){var t='<div class="configAdminForm"><div class="configAdminDetail">';t+='<label class="addAdminLink" for="addAdminCheckbox">+添加群组</label>',t+='<input type="checkbox" class="addAdminCheckbox" id="addAdminCheckbox">',t+='<input type="text" class="addAdminInput lbSearchInput" placeholder="搜索群组"></div><div style="height:10px;"></div></div>',a.showConfigAdminbox(t),s.Options.groupHtml?($(".configAdminDetail").append(s.Options.groupHtml),s.selsectGroupBind()):s.getGroups()},s.getGroups=function(){var t={},e={},i={};$.get("/Project/Group?format=json&projectid="+p.project.projectId,function(o){$.each(o,function(o,n){t[n.id]=n,e[n.id]||(i[n.id]=n)});var n='<ul class="allGroupsList">';for(var a in i)n+='   <li class="allGroupsItem" data-id="'+i[a].id+'" title="'+i[a].name+'">',n+='   <img src="'+i[a].avatar+'" alt="'+i[a].name+'" class="groupAvatar">',n+='    <div class="groupName">'+i[a].name+"</div>",n+="   </li>";n+="   </ul>",$(".configAdminDetail").append(n),s.Options.groupHtml=n,s.selsectGroupBind()})},s.selsectGroupBind=function(){var t=$(".configAdminForm").find(".allGroupsList");$.each(t.find(".allGroupsItem"),function(t,e){var i=$(e).find(".groupName").toPinyin();$(e).data("pinyin",i.toLowerCase())}),$(".configAdminForm").find(".lbSearchInput").keyup(function(t){var e=$("<span>"+$(".configAdminForm").find(".lbSearchInput").val()+"</span>").toPinyin().toLowerCase();console.log(e);for(var i=$(".configAdminForm").find(".allGroupsItem"),o=0;o<i.length;o++){var n=$(i[o]),a=n.data("pinyin");a.indexOf(e)<0?n.hide():n.show()}}),$(".allGroupsList .allGroupsItem").click(function(){for(var t=$(this).attr("data-id"),e=$(this).find(".groupName").text(),i=$(this).find(".groupAvatar").attr("src"),o=$(".selectedGroups .selectedGroupItem"),n=0;n<o.length;n++)if($(o[n]).data("id")==t)return void a.Commit("已选择","2");if($(".selectedGroupList").append($('<li class="selectedGroupItem" data-id="'+t+'"><span><img src="'+i+'" alt="战略研究wwwwwwwwwwww" class="groupAvatar"></span> <span class="selectedGroupName">'+e+'</span> <span class="addedAdminDeleteLink">×</span></li>')),s.initDeleteLink(),s.Options.selectGroupHeight){if($(".appConfigDetail .selectedGroups").height()>s.Options.selectGroupHeight){s.Options.selectGroupHeight=$(".appConfigDetail .selectedGroups").height();var p=$(".configAdminbox .container").offset().top;$(".configAdminbox .container").css("top",p+40)}}else{s.Options.selectGroupHeight=$(".appConfigDetail .selectedGroups").height();var p=$(".configAdminbox .container").offset().top;$(".configAdminbox .container").css("top",p+40)}})},s.initDeleteLink=function(){$(".addedAdminDeleteLink").click(function(t){$(this).parent().remove()})},s.checkGroupButtom=function(){$(".selectGroupRadio").click(function(){$(".selectGroupRadio").attr("checked",!1),$(this).prop("checked",!0),"select"===$(this).val()?($("#partGroupsRadio").show(),$(".appConfigDetail .selectedGroups").show()):($("#partGroupsRadio").hide(),$(".appConfigDetail .selectedGroups").hide())})},i.exports=s});